<a href="images/NLA-Stride_LOGO2.png"><img src="images/NLA-Stride_LOGO2.png" width="250"></a>  

# 使用手册（简体中文）

> 本手册介绍 NLA-Stride Blender 外挂的相关功能与一些技巧，也有一些常见的一致问题回答。

---

## 📘 目录

1. [快速开始](#-快速开始)  
2. [版更重点](#-版本更新重点)
3. [功能总览](#-功能总览)      
4. [常见问题](#-常见问题) 
5. [其他](#-其他) 
6. [技术参考](#-技术参考)

---

## 🚀 快速开始

### 1. 外挂安装

1. 使用 Blender 官方的安装步骤即可 ( **[通用安装教学](https://docs.blender.org/manual/en/latest/editors/preferences/addons.html)** )

2. 安装外挂后，在 Blender 3D 检视中的 **侧栏 → 动画** 页签可以看到 **NLA Stride Tool**。 
<br>![alt text](images/img_1001.png)



---

### 2. 选取具有动画的物件  
<a href="images/img_1002.png">
  <img src="images/img_1002.png" width="650">
</a>  

选取一或多个含有动画数据的物件。如果是标准动画而非 NLA 动画，请参阅「大量建立 NLA」说明。

---

### 3. 加入清单

![alt text](images/img_1003.png)

⚠️ 请注意：外挂是依靠清单运作，与即时选取物件无关。

---

### 4. NLA 对齐 / 错位操作


<a href="images/img_1004.png"><img src="images/img_1004.png" width="650"></a>  

<a href="images/img_1005.png"><img src="images/img_1005.png" width="650"></a>  

<a href="images/img_1006.png"><img src="images/img_1006.png" width="650"></a>  


以上是 NLA 对齐与错位功能示意。

---

### 5. 享受动画魅力

<a href="images/DEMO_01.mp4">
  <img src="images/DEMO_01.gif" width="720">
</a>  

<a href="images/DEMO_02.mp4">
  <img src="images/DEMO_02.gif" width="720">
</a>  

<a href="images/DEM3_03.mp4">
  <img src="images/DEMO_03.gif" width="720">
</a>  

<a href="images/DEM3_04.mp4">
  <img src="images/DEMO_04.gif" width="720">
</a>  

此范例模型感谢台湾 [SANSUI / 山水品牌](https://www.sansuitw.com/?gad_source=1&gad_campaignid=23085773952&gbraid=0AAAAAoXC59ENhboAZDO-y0zK4yQpidtXM&gclid=CjwKCAiAybfLBhAjEiwAI0mBBscjnZOEYBBY127EypNMfnL1h_Vqm_HACczeJBOqMK-euDJFPb1iAxoC7rkQAvD_BwE)  赞助提供

---
## 🌟 版本更新重点
#### v1.0.0 更新重点
- 清单的导出 / 导入 / 追加  
  ![alt text](images/v100_001.png)  
  1. 清单操作内增加三个功能
  2. 导出及导入清单都会以 *.json 为主
  3. 追加会追加在清单的最后
  4. 如有名称重复，会以最先的为主
#### v0.9.8 更新重点  
- 对外发布初始版  
---
## 🧰 功能总览

#### 1. 清单初始化工具 

![alt text](images/img_2001.png)

- A : 初始并加入所选    
  会清空清单数据后再添加 场景 中所选的物件  
  <br>
- B : 清空清单  
  清除清单内所有数据  
  <br>
- C : 动画来源  
    目前支援有三种类型  
    -  物件动画  
    -  形态键动画 ( 外形键 )  
    -  材质动画
  <br>
- D : 清单中物件 增 / 减  
  增加时 **不会** 清空，物件会 **依选取顺序** 添加在最后，若有选到清单中已经存在的物件，也会依照顺序放到清单最后，增加的方式与上面要介绍的 A 的增加方式有所不同，删减的部分也与 1-J 有所差异  
  <br>

- E : 清单操作 ( 下拉选单 )  
  详情见 [1-1 清单操作](#1-1-清单操作)
  <br>

- F : 清单中选取物件 上移 / 下移  
  手动调整排序，若有使用此功能调动顺序，调整后的结果就会被定义为 **" 缓存原始顺序 "**
  <br>

- G : 推送动画至 NLA ( 下拉选单 )  
  只针对清单中的物件做转换。
  <br>  
  
-  PS. [3.清单中内容说明](#3-清单中的图示意义)

#### 1-1. 清单操作

![alt text](images/img_2002.png)

- H : 初始并加入所选   
  会清空清单数据后再添加 场景 中所选的物件
  <br>

- I : 四种排序    
  最重要的是 **原始顺序** 本外挂会记录该顺序，另外三个都是
  <br>

- J : 移除场景所选    
  是针对场景中所选定的物件，与 1-D 的移除，有所不同。
  <br>

#### 2. 指定错位片段

![alt text](images/img_2003.png)

- K : 三种片段模式  
  - 单一片段 : 只针对一段片段做改变
  - 单一轨道 : 会把一条轨道上的所有片段看成是一整段  ( 相对位置不会变 )
  - 所有轨道 : 等同于是物件中的所有轨道一起改变 ( 相对位置不会变 )
  <br>

- L : 三个定位点  
  - 哪个槽位 : 只有材质模式才有，在 NLA 介面中是 **由上而下** 计算
  - 第几轨道 : 只有材质模式才有，在 NLA 介面中是 **由下而上** 计算
  - 第几片段 : 只有材质模式才有，在 NLA 介面中是 **由左至右** 计算
  <br>

  **!! 注意 : 没有真正定位到目标，NLA 会无法错位**

#### 3. NLA 对齐工具 ( 初始化数值 )
![alt text](images/img_2004.png)

- M : 五种对齐模式  
  - 依最大开始帧 : 清单中的 NLA 中最 **晚** 开始的片段之 **开头** 为准
  - 依最小开始帧 : 清单中的 NLA 中最 **早** 开始的片段之 **开头** 为准 ( 常用 )
  - 依最大结束帧 : 清单中的 NLA 中最 **晚** 结束的片段之 **结尾** 为准 ( 常用 )
  - 依最小结束帧 : 清单中的 NLA 中最 **早** 结束的片段之 **结尾** 为准
  - 依目前时间 : 依目前播放磁头位置为准 (最常用)
  <br>

- N : 三种对齐方式  
  - 齐开始 : 依照目标向左靠齐，常用于 **开始** 的目标对齐
  - 齐中 : 依照目标向中央对齐
  - 齐结束 : 依照目标向右靠齐，常用于 **结束** 的目标对齐
  <br>

- O : 重置缩放  
  将清单中所有 NLA 的片段缩放值，回归到数值 1
  <br>


#### 4. 简易模式

![alt text](images/img_2005.png)  
- P : 简易模式衰减 [( 详细说明 )](#2-错位说明)  
  错位计算公式共有四种 : 1.线性 / 2.淡入 / 3.淡出 / 4.淡入淡出
  <br>

- Q : 位移量 ( 单位 **帧** )  
  不是片段的等距差，而是列表第一个物件，与最后一个物件的差 ( 可以入负数 )
  <br>

- R : 缩放  
  不是片段的等距缩放，而是列表第一个物件，与最后一个物件的缩放差 ( 0 ~ 1 )
  <br>

- S : 执行简易 NLA 错位 ( 一直按会累加计算 )
  <br>

#### 5. 专业模式
![alt text](images/img_2006.png)  
  **>> 本外挂最重要的核心，只要简单设定，片段的错位与缩放会自动调整 <<**

- T : 专业模式开始衰减 [( 详细说明 )](#2-错位说明)  
  错位计算公式共有四种 : 1.线性 / 2.淡入 / 3.淡出 / 4.淡入淡出
  <br>

- U : 设定开始帧  
  设定整段动画，也就是清单中所有物件的动画表演 **开始** 时间
  <br>

- V : 位移比例    
  与 开始衰减 ( T )相乘出的错位量，用于 自动化设定所有片段的起始点
  <br>

- W : 专业模式结束衰减 [( 详细说明 )](#2-错位说明)    
  错位计算公式共有四种 : 1.线性 / 2.淡入 / 3.淡出 / 4.淡入淡出
  <br>

- X : 设定结束帧    
  设定整段动画，也就是清单中所有物件的动画表演 **结束** 时间
  <br>

- Y : 位移比例    
  不是片段的等距差，而是列表第一个物件，与最后一个物件的差 ( 可以入负数 )
  <br>

- Z : 执行专业 NLA 错位 ( 一直按 **不会** 累加计算 )
  <br>


---

## ❓ 常见问题


#### 1. ⚠️ 注意「实例化数据（Instanced Data）」的细节

本外挂主要针对 NLA 片段（Strips）本身进行错位与对齐处理，  
并 **不会** 自动处理 Blender 的「实例化数据」关系。

#### 什么是实例化数据？

当**多个物件共用同一份数据**时，这些数据就是「实例化（Instanced）」的。

- 例如：  
  - 两个物件共用同一个材质球  
  - 或共用同一个动画、网格、或其他数据区块  

在 NLA 编辑器中看起来像是两条独立片段，但实际上**背后指向的是同一份数据**。
结果就是，在这种情况下使用 **NLA Stride 进行错位**时，外挂看似在移动不同片段，但实际上仍在影响同一份数据，因此**无法达成你预期的错位效果**。


#### ✅ 解决方式（ 搭配下方截图操作 ）

> 💡 **关键做法：先将数据独立化，再进行错位**

步骤如下（ 如图所示 ）：

1. 在 3D 视窗中选取需要处理的物件  
2. 开启 **物件 → 关联数据（Relations）** 3. 点击 **使单一使用者（Make Single User）** 4. 依需求选取需要独立的数据类型
5. 确认数据已独立后，再使用 **NLA Stride** 进行错位  



![alt text](images/img_3001.png)

> 数据独立后，每个物件都会拥有「真正独立的 NLA 数据」
> NLA Stride 即可 **正常、可预测地错位 NLA 片段** 。
---


#### 2. ⚠️大量建立 NLA

本外挂主要针对 NLA 片段（Strips）本身进行错位与对齐处理，所以非 NLA 片段的动画，不会有所改变。

#### ✅ 解决方式 : 大量转换工具

外挂将针对清单中的物件，做一次性的大量转换 ( 下图绿色箭头 )，请特别注意是 **清单中** 而非 3D检视中选到的物件。

![alt text](images/img_3002.png)

---



## 📖 其他说明


#### 1. 对齐与错位策略小技巧

- 可以在 3D 检视中 按 **Alt A** 取消所有选取后，再用 **选取清单物件** 功能，确认清单中到底选了那些物件。  
<br>

- 因为 **顺序** 很重要，他直接影响错位后的动画状态，如果可以请用名称决定顺序，倘若物件真的很多，也可以分批处理。  
<br>

- 当状况变的混乱，可以用对齐工具先统一回来  
<br>

- 因为动画错位将变得很简单，所以请专注建立一段  **完美的动态**。  
<br>

- 动作设计上 如果有设定到 **位置** 在复制时，要注意，播放动画，会跳回到同一位置，因为位置资讯被写入到 NLA 中，这时候我们可以用套用 **ctrl A** 功能，将新的位置写入到 **增减变换** 数据中  
  <br>![alt text](images/img_4001.png)  

---

#### 2. 错位说明
- 线性叠加模式 :  
  - 简易模式 :   
  <a href="images/img_4002.png"><img src="images/img_4002.png" width="650"></a>  
  简易模式会以原本的状态 (如上图最左边) 叠加模式计算，如图 错位与缩放的数值设定 :位移量 100、缩放 1.5 ，最后一个片段的起始点 与长度(也可以说是结束点) 一定都会一样；但可以看到因为叠加模式的不同，造成其他片段的起始点不同，造成不同的错位感觉。

    ---
  - 专业模式 :    
  <a href="images/img_4003.png"><img src="images/img_4003.png" width="650"></a>  
  与简易模式只差异于，专业模式可以设定控制 头 与 尾，所以有多一个 叠加模式可以分别设定  
  
    ---
  - **注意** :   
  <a href="images/img_4004.png"><img src="images/img_4004.png" width="650"></a>  
  要注意头尾的两种叠加模式如果 **不同**，需要注意动画片段会不会有问题
    ( 过短或是消失 )。
---

#### 3. 清单中的图示意义

![alt text](images/img_3003.gif)

图 A : 动画来源
图 B : Action 代表一般的 动画数据 (非 NLA 的动画数据)
图 C : 可用 NLA 数据

- 图 B 与 图 C 中的图示意义，会因为 A栏中的 动画来源而改变 :
  - ✔ : 有符合 A 栏中设定的 **正确** 数据
  - ・: 有数据，但 **不是** A 栏中设定的数据
  - ✕ : 没有数据

画面中的数据 :
| 项目 | 物件动画 | 材质动画 | 形态键动画 |
|------|------|------|--------|
| **NLA 片段** | cube.049 | cube.050 | cube.051 | 
| **活动动作** | cube.027 | cube.037 | cube.038 | 

- 其他 : cube.000 ( 3 类型的 NLA 全都有 )   /   cube.039 ( 完全没有动画数据 )

---




## 🔧 技术参考

  [Blender NLA 官方手册](https://docs.blender.org/manual/en/latest/editors/nla/index.html)

  [Blender API 官方手册](https://docs.blender.org/api/current/bpy.ops.nla.html)

  


## 📘 目录

1. [快速开始](#-快速开始) 
2. [版更重点](#-版本更新重点) 
3. [功能总览](#-功能总览)      
4. [常见问题](#-常见问题) 
5. [其他](#-其他) 
6. [技术参考](#-技术参考)
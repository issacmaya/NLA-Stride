<a href="images/NLA-Stride_LOGO2.png"><img src="images/NLA-Stride_LOGO2.png" width="250"></a>  

# 使用手册（简体中文）

> 本手册介绍 NLA-Stride Blender 插件的相关功能与一些技巧，也有一些常见的已知问题回答。

---

## 📘 目录

1. [快速开始](#-快速开始)  
2. [功能总览](#-功能总览)      
3. [常见问题](#-常见问题) 
4. [其他](#-其他) 
5. [技术参考](#-技术参考)

---

## 🚀 快速开始

### 1. 插件安装

1. 使用 Blender 官方的安装步骤即可 ( **[通用安装教学](https://docs.blender.org/manual/en/latest/editors/preferences/addons.html)** )

2. 安装插件后，在 Blender 3D 视图中的 **侧栏 → 动画** 页签可以看到 **NLA Stride Tool**。 
<br>![alt text](images/img_1001.png)



---

### 2. 选取具有动画的物体  
<a href="images/img_1002.png">
  <img src="images/img_1002.png" width="650">
</a>  

选取一个或多个含有动画资料的物体，如果是预设的 Action 而非 NLA 片段，请参考下方 “批次推送至 NLA” 说明。  

---

### 3. 加入至清单  
![alt text](images/img_1003.png)  

⚠️ 注意：插件运行是以清单为主，不论视图中目前的选取状态。  

---

### 4. NLA 对齐 / 错位操作  
<a href="images/img_1004.png"><img src="images/img_1004.png" width="650"></a>  
<a href="images/img_1005.png"><img src="images/img_1005.png" width="650"></a>  
<a href="images/img_1006.png"><img src="images/img_1006.png" width="650"></a>  

以上为 NLA 对齐与错位的功能演示。  

---

### 5. 享受动画魔法  
<a href="images/DEMO_01.mp4">
  <img src="images/DEMO_01.gif" width="720">
</a>  
<a href="images/DEMO_02.mp4">
  <img src="images/DEMO_02.gif" width="720">
</a>  
<a href="images/DEM3_03.mp4">
  <img src="images/DEMO_03.gif" width="720">
</a>  
<a href="images/DEM3_04.mp4">
  <img src="images/DEMO_04.gif" width="720">
</a>  

特别感谢台湾品牌 [SANSUI 山水](https://www.sansuitw.com/?gad_source=1&gad_campaignid=23085773952&gbraid=0AAAAAoXC59ENhboAZDO-y0zK4yQpidtXM&gclid=CjwKCAiAybfLBhAjEiwAI0mBBscjnZOEYBBY127EypNMfnL1h_Vqm_HACczeJBOqMK-euDJFPb1iAxoC7rkQAvD_BwE) 提供范例模型。  

---

## 🧰 功能总览

#### 1. 动画来源 
![alt text](images/img_2001.png)  

- A : 初始并加入所选  
  先清空清单，再加入目前场景中选取的物体。  
<br>

- B : 清空清单  
  清除清单中的所有资料。  
<br>

- C : 动画来源  
  目前支援三种：物体动画 / 形态键动画 / 材质动画。  
<br>

- D : 增加 / 删除清单项目  
  增加 **不会** 清空前次清单，会依 **选取顺序** 依序加入到最后，若选取已在清单中的物体，会将其移动到最后。加入逻辑与 A 不同。删除工具也与 1-J 不同。  
<br>

- E : 清单操作 (下拉选单)  
  详见 “1-1 清单操作”。  
<br>

- F : 上移 / 下移项目  
  手动调整顺序。一旦调整，此结果即定义为 **“原始顺序”**。  
<br>

- G : 推送至 NLA (下拉选单)  
  将当前的动作转换为 NLA 片段，仅针对清单内的物体。  
<br>

- PS. [3. 清单图示意义](#3-清单图示意义)  

#### 1-1. 清单操作
![alt text](images/img_2002.png)  

- H : 初始并加入所选  
  先清空清单，再加入目前场景中选取的物体。  
<br>

- I : 四种排序选项  
  最重要的是 **恢复原始顺序**，因为此插件会记录该顺序，其他三种为自动排序。  
<br>

- J : 移除场景选取  
  根据视图目前的选取状态，从清单中移除该物体。这与 1-D 删除工具不同。  

#### 2. 资料定位
![alt text](images/img_2003.png)  

- K : 三种片段模式  
  - 单一片段 : 锁定针对单一指定的片段。  
  - 单一轨道 : 该轨道内的所有片段视为一组（相对位置不变）。  
  - 所有轨道 : 等同于同时变动物体的所有轨道（相对位置不变）。  
<br>

- L : 三个定位点  
  - 哪个槽位 : ( 仅限材质模式 ) 以 UI **由上至下** 计算。  
  - 哪个轨道 : 以 NLA 编辑器 **由下至上** 计算。  
  - 哪个片段 : 以 NLA 编辑器 **由左至右** 计算。  
<br>

  **!! 注意：若目标定位不正确，NLA Stride 将无法运行错位。** #### 3. NLA 对齐工具 ( 初始值 )
![alt text](images/img_2004.png)  

- M : 五种对齐目标  
  - 齐最大开始帧 : 对齐清单中，**最晚** 开始片段的 **起始** 点。  
  - 齐最小开始帧 : 对齐 **最早** 开始片段的 **起始** 点 ( 常用 )。  
  - 齐最大结束帧 : 对齐 **最晚** 结束片段的 **结束** 点 ( 常用 )。  
  - 齐最小结束帧 : 对齐 **最早** 结束片段的 **结束** 点。  
  - 齐当前时间 : 对齐播放头目前的位置 ( 最常见 )。  
<br>

- N : 三种对齐模式  
  - 齐开始 : 片段左侧对齐目标。通常用于 **开始** 对齐。  
  - 齐中 : 片段中心对齐目标。  
  - 齐结束 : 片段右侧对齐目标。通常用于 **结束** 对齐。  
<br>

- O : 重置缩放  
  将清单内所有 NLA 片段的缩放值恢复为 1.0。  


#### 4. 简易模式
![alt text](images/img_2005.png)  

- P : 叠加模式 [( 详细说明 )](#2-错位说明)  
  - 四种计算公式：1. 线性 / 2. 淡入 / 3. 淡出 / 4. 淡入淡出。  
<br>

- Q : 位移量 ( 单位：**帧** )  
  - 并非单一片段间的间距，而是清单内第一个物体到最后一个物体的总差值 ( 允许负值 )。  
<br>

- R : 缩放  
  - 并非递增缩放，而是清单内第一个物体到最后一个物体的缩放差值 ( 0 ~ 1 )。  
<br>

- S : 运行简易 NLA 错位 ( 重复点击会累加计算 )。  
<br>

#### 5. 专业模式
![alt text](images/img_2006.png)  
  **>> 本外挂核心，透过简单设定，自动调整片段错位与缩放 <<** - T : 叠加模式 [( 详细说明 )](#2-错位说明)  
  - 四种计算公式：1. 线性 / 2. 淡入 / 3. 淡出 / 4. 淡入淡出。  
<br>

- U : 设定开始帧  
  - 设定清单内所有物体动画序列的 **起始** 时间。  
<br>

- V : 位移比例 ( 头 )  
  - 与叠加模式 ( T ) 相乘计算位移值，用于自动定位所有片段起始点。  
<br>

- W : 叠加模式 [( 详细说明 )](#2-错位说明)  
  - 四种计算公式：1. 线性 / 2. 淡入 / 3. 淡出 / 4. 淡入淡出。  
<br>

- X : 设定结束帧  
  - 设定清单内所有物体动画序列的 **结束** 时间。  
<br>

- Y : 位移比例 ( 尾 )  
  - 片段结束点的位移比例。  
<br>

- Z : 运行专业 NLA 错位 ( 重复点击 **不会** 累加计算 )。  
<br>


---

## ❓ 常见问题


#### 1. ⚠️ 注意 “关联资料 ( Instanced Data )”

本外挂主要处理 NLA 片段本身的错位与对齐，并 **不会** 自动处理 Blender 内部的 “关联资料” 关系。  

#### 什么是关联资料？

当 **多个物体共用同一份资料** 时，这些资料块就是 “关联” 的。  

- 例如：  
  - 两个物体共用同一个材质。  
  - 共用同一个动作 ( Action )、网格 ( Mesh ) 或其他资料块。  

在 NLA 编辑器中，它们看起来可能是两个独立的片段，但实际上它们都 **指向同一个底层的资料块**。
这会导致在使用 **NLA Stride 错位** 时，插件看似移动了不同的片段，但实际上修改的是同一份资料，因此 **无法达到预期的错位效果**。


#### ✅ 解决方法 ( 请参考图片步骤 )

> 💡 **核心逻辑：在进行错位前，先让资料独立。** 步骤如下 ( 如图所示 )：  

1. 在 3D 视图中选取要处理的物体。  
2. 进入 **物体 ( Object ) → 关系 ( Relations )**。  
3. 点击 **使其独立 ( Make Single User )**。  
4. 勾选需要独立的资料类型 ( 例如：物体动画 )。  
5. 资料独立后，再使用 **NLA Stride** 进行错位。  



![alt text](images/img_3001.png)  

> 当资料独立后，每个物体都会拥有自己专属的 NLA 资料。
> NLA Stride 就能 **正常且可预期地帮您将 NLA 片段错开**。  

---


#### 2. ⚠️ 批次建立 NLA

本插件的对象是 NLA 片段，若动画资料尚未 “推送” ( Push down ) 变成 NLA 片段，则不会受到影响。  

#### ✅ 解决方法：推送至 NLA 工具

插件提供了批次转换工具 ( 如下方绿箭处 )。注意其对象是 **清单内** 的物体，而非视图选取。  

![alt text](images/img_3002.png)  

---



## 📖 其他


#### 1. 对齐与错位策略技巧

- 可以先在 3D 视图按 **Alt A** 全不选，再利用 **选取清单物件** 功能，精准确认你的清单里有哪些人。  
<br>

- **顺序** 至关重要，因为这直接影响错位后的动画状态。尽可能利用命名规则来决定顺序。若有大量物体，请分批处理。  
<br>

- 弄乱时，利用对齐工具，先让大家统一。  
<br>

- 因为动画错位变得非常容易，可以将精力放在制作一个 **完美的动感**。  
<br>

- 若动感设计包含 **位置**，在复制时要注意，播放动画可能会跳回到同一位置，因为位置资讯被写入到了 NLA 中。这时我们可以用套用 **Ctrl A** 功能，将新的位置写入到 **增减变换** 资料中。  
  <br>![alt text](images/img_4001.png)  

---

#### 2. 错位说明
- 线性叠加模式 :  
  - 简易模式 :   
  <a href="images/img_4002.png"><img src="images/img_4002.png" width="650"></a>  
  简易模式会以原本的状态 ( 如上图最左边 ) 叠加模式计算。如图所示，位移量设为 100、缩放设为 1.5 時，最后一个片段的起始点与长度 ( 也可以说是结束点 ) 一定都会一样；但可以看到因为叠加模式的不同，造成其他片段的起始点不同，产生不同的错位感觉。  

    ---
  - 专业模式 :    
  <a href="images/img_4003.png"><img src="images/img_4003.png" width="650"></a>  
  与简易模式的差异在于，专业模式可以分别设定控制 “头” 与 “尾”，因此多了一个叠加模式可以分别设定。  
  
    ---
  - **注意** :   
  <a href="images/img_4004.png"><img src="images/img_4004.png" width="650"></a>  
  要注意头尾两种叠加模式若 **不同**，需注意动画片段是否会出现问题 ( 过短或消失 )。  

---

#### 3. 清单图示意义

![alt text](images/img_3003.gif)  

图示 A : 资料模式  
图示 B : Action 代表一般的动画资料 ( 非 NLA )。  
图示 C : 现有的 NLA 资料。  

- B 與 C 的图示意义会根据 A 栏的资料模式而变动：  
  - ✔ : 含有符合 A 栏模式的 **正确** 资料。  
  - ・ : 含有资料，但 **不是** A 栏所设定的类型。  
  - ✕ : 未找到资料。  

视图中资料：  
| 项目 | 物体动画 | 材质动画 | 形态键动画 |
|------|------|------|--------|
| **NLA 片段** | cube.049 | cube.050 | cube.051 | 
| **作用中动作** | cube.027 | cube.037 | cube.038 |  

- 其他：cube.000 ( 三种 NLA 类型皆有 ) / cube.039 ( 没有任何动画资料 )。  

---

## 🔧 技术参考

  [Blender NLA 官方手册](https://docs.blender.org/manual/en/latest/editors/nla/index.html)  

  [Blender API 官方手册](https://docs.blender.org/api/current/bpy.ops.nla.html)  

  


## 📘 目录

1. [快速开始](#-快速开始)  
2. [功能总览](#-功能总览)      
3. [常见问题](#-常见问题) 
4. [其他](#-其他) 
5. [技术参考](#-技术参考)

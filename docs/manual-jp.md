<a href="images/NLA-Stride_LOGO2.png"><img src="images/NLA-Stride_LOGO2.png" width="250"></a>  

# ユーザーマニュアル (日本語)

> 本マニュアルでは、NLA-Stride Blender アドオンの機能とヒント、および既知の問題への回答について説明します。

---

## 📘 目次

1. [クイックスタート](#-クイックスタート)  
2. [アップデートのポイント](#-アップデートのポイント)
3. [機能概要](#-機能概要)      
4. [よくある質問](#-よくある質問) 
5. [その他のヒント](#-その他のヒント) 
6. [技術リファレンス](#-技術リファレンス)

---

## 🚀 クイックスタート

### 1. アドオンのインストール

1. Blender 公式のインストール手順に従ってください ( **[一般的なインストールガイド](https://docs.blender.org/manual/en/latest/editors/preferences/addons.html)** )

2. インストール後、Blender 3D ビューポートの **サイドバー → アニメーション** タブに **NLA Stride Tool** が表示されます。 
<br>![alt text](images/img_1001.png)



---

### 2. アニメーションを持つオブジェクトを選択  
<a href="images/img_1002.png">
  <img src="images/img_1002.png" width="650">
</a>  

アニメーションデータを含む 1 つまたは複数のオブジェクトを選択します。NLA ストリップではなく標準のアニメーションを使用している場合は、「NLA へプッシュ」の手順を参照してください。

---

### 3. リストに追加

![alt text](images/img_1003.png)

⚠️ 注意：本アドオンは、シーン内で現在選択されているオブジェクトに関係なく、リストに基づいて動作します。

---

### 4. NLA 整列 / オフセット操作


<a href="images/img_1004.png"><img src="images/img_1004.png" width="650"></a>  

<a href="images/img_1005.png"><img src="images/img_1005.png" width="650"></a>  

<a href="images/img_1006.png"><img src="images/img_1006.png" width="650"></a>  


上の図は、NLA の整列およびオフセット機能を示しています。

---

### 5. アニメーションを楽しむ

<a href="images/DEMO_01.mp4">
  <img src="images/DEMO_01.gif" width="720">
</a>  

<a href="images/DEMO_02.mp4">
  <img src="images/DEMO_02.gif" width="720">
</a>  

<a href="images/DEM3_03.mp4">
  <img src="images/DEMO_03.gif" width="720">
</a>  

<a href="images/DEM3_04.mp4">
  <img src="images/DEMO_04.gif" width="720">
</a>  

サンプルモデル提供： [SANSUI Taiwan](https://www.sansuitw.com/?gad_source=1&gad_campaignid=23085773952&gbraid=0AAAAAoXC59ENhboAZDO-y0zK4yQpidtXM&gclid=CjwKCAiAybfLBhAjEiwAI0mBBscjnZOEYBBY127EypNMfnL1h_Vqm_HACczeJBOqMK-euDJFPb1iAxoC7rkQAvD_BwE)

---
## 🌟 アップデートのポイント
#### v1.0.0 アップデート
- リストの書き出し / インポート / 追加  
  ![alt text](images/v100_001.png)  
  1. リスト操作に 3 つの機能を追加しました。
  2. 書き出しとインポートは *.json 形式を使用します。
  3. 「追加」はリストの末尾に項目を追加します。
  4. 名前が重複している場合は、最初に見つかったものが優先されます。
#### v0.9.8 アップデート  
- 初回公開リリース  
---
## 🧰 機能概要

#### 1. リスト初期化ツール 

![alt text](images/img_2001.png)

- A : 初期化して選択項目を追加    
  リストデータをクリアしてから、現在シーンで選択されているオブジェクトを追加します。
  <br>
- B : リストをクリア  
  リスト内のすべてのデータを消去します。
  <br>
- C : アニメーションソース  
    現在、3 つのタイプをサポートしています：
    - オブジェクトアニメーション  
    - シェイプキーアニメーション  
    - マテリアルアニメーション
  <br>
- D : オブジェクトをリストに追加 / 削除  
  追加しても既存の項目は**クリアされません**。オブジェクトは**選択順**に末尾に追加されます。ここでの削除は 1-J とは異なります。
  <br>

- E : リスト操作 (ドロップダウンメニュー)  
  詳細は [1-1 リスト操作](#1-1-リスト操作) を参照してください。
  <br>

- F : 選択項目を上へ / 下へ移動  
  手動でソートを調整します。順序が調整された場合、その結果は**「元の順序」**として定義されます。
  <br>

- G : NLA へプッシュ (ドロップダウンメニュー)  
  リスト内のオブジェクトのアニメーションのみを NLA ストリップに変換します。
  <br>  
  
-  PS. [3. リストアイコンの凡例](#3-リストアイコンの凡例)

#### 1-1. リスト操作

![alt text](images/img_2002.png)

- H : 初期化して選択項目を追加   
  リストデータをクリアし、現在選択されているオブジェクトを追加します。
  <br>

- I : ソートモード    
  **元の順序**（アドオンが保持）と他の 3 つのソート方法が含まれます。
  <br>

- J : シーンの選択項目を削除   
  シーンで現在選択されているオブジェクトをリストから削除します。
  <br>

#### 2. オフセットストリップを指定

![alt text](images/img_2003.png)

- K : ストリップモード  
  - シングルストリップ：特定の 1 つのストリップのみを対象にします。
  - シングルトラック：1 つのトラック上のすべてのストリップを 1 つのユニットとして扱います（相対位置を維持）。
  - 全トラック：オブジェクトのすべてのトラックが一緒に変化します（相対位置を維持）。
  <br>

- L : スロット/トラック/ストリップの位置指定  
  - スロット：マテリアルモードのみ。インターフェースの**上から下**へ計算されます。
  - トラック：NLA エディターの**下から上**へ計算されます。
  - ストリップ：NLA エディターの**左から右**へ計算されます。
  <br>

  **!! 注意：ターゲットが正しく特定されない場合、NLA Stride は機能しません。**

#### 3. NLA 整列ツール (初期値)
![alt text](images/img_2004.png)

- M : 整列モードのターゲット  
  - 最大開始フレームで：リスト内で最も**遅く**始まるストリップの**開始点**に合わせます。
  - 最小開始フレームで：リスト内で最も**早く**始まるストリップの**開始点**に合わせます（一般的）。
  - 最大終了フレームで：リスト内で最も**遅く**終わるストリップの**終了点**に合わせます（一般的）。
  - 最小終了フレームで：リスト内で最も**早く**終わるストリップの**終了点**に合わせます。
  - 現在時刻で：現在の再生ヘッドの位置に合わせます（最も一般的）。
  <br>

- N : 整列位置  
  - 開始で整列：左端をターゲットに合わせます。
  - 中央で整列：中心をターゲットに合わせます。
  - 終了で整列：右端をターゲットに合わせます。
  <br>

- O : スケールをリセット  
  リスト内の指定されたすべての NLA ストリップのスケールを 1 にリセットします。
  <br>


#### 4. 簡易モード

![alt text](images/img_2005.png)  
- P : 減衰モード (Falloff) [(詳細説明)](#2-オフセットの説明)  
  4 つの計算式：1. 線形 / 2. イーズイン / 3. イーズアウト / 4. イーズインアウト。
  <br>

- Q : オフセット量 (単位：**フレーム**)  
  ストリップ間の等間隔の隙間ではなく、リストの最初と最後のオブジェクト間の合計差分です（負の値も可能）。
  <br>

- R : スケール  
  等間隔ののスケーリングではなく、最初と最後のオブジェクト間のスケール差です (0 ~ 1)。
  <br>

- S : 簡易 NLA ストライドを実行 (繰り返し押すと値が累積されます)。
  <br>

#### 5. プロモード
![alt text](images/img_2006.png)  
  **>> コア機能：開始点と終了点を定義すると、ストリップが自動的にオフセットおよびスケーリングされます。 <<**

- T : プロ開始減衰 [(詳細説明)](#2-オフセットの説明)  
  オフセット計算式：線形、イーズイン、イーズアウト、またはイーズインアウト。
  <br>

- U : 開始フレームを設定  
  リスト内のアニメーションシーケンス全体のグローバルな**開始**時間を設定します。
  <br>

- V : オフセット比率  
  オフセット量に減衰モード (T) を掛けたもので、開始フレームの位置決めに使用されます。
  <br>

- W : プロ終了減衰 [(詳細説明)](#2-オフセットの説明)    
  オフセット計算式：線形、イーズイン、イーズアウト、またはイーズインアウト。
  <br>

- X : 終了フレームを設定    
  リスト内のアニメーションシーケンス全体のグローバルな**終了**時間を設定します。
  <br>

- Y : オフセット比率    
  最初と最後のオブジェクトの終了フレームの差です（負の値も可能）。
  <br>

- Z : プロ NLA ストライドを実行 (値は累積**されません**)。
  <br>


---

## ❓ よくある質問


#### 1. ⚠️ 「インスタンス化されたデータ (Instanced Data)」の詳細に注意

本アドオンは、オフセットと整列のために NLA ストリップ自体をターゲットにしており、  
Blender の「インスタンス化されたデータ」の関係を自動的に処理するものでは**ありません**。

#### インスタンス化されたデータとは？

**複数のオブジェクトが同じデータブロックを共有**している場合、そのデータは「インスタンス化」されています。

- 例：  
  - 2 つのオブジェクトが同じマテリアルを共有している。  
  - 同じアクション、メッシュ、またはその他のデータブロックを共有している。  

NLA エディターでは、それらは 2 つの独立したストリップのように見えますが、**舞台裏では同じデータを指しています**。
その結果、**NLA Stride を使用してオフセット**しても、アドオンはストリップを移動させますが、それらが同じ基盤データを参照しているため、**期待通りのオフセット効果は得られません**。


#### ✅ 解決策 (下のスクリーンショットに従ってください)

> 💡 **重要な習慣：オフセットする前にデータを独立させる**

手順：

1. 3D ビューポートでオブジェクトを選択します。  
2. **オブジェクト → 関係 (Relations)** に移動します。  
3. **シングルユーザー化 (Make Single User)** をクリックします。  
4. 独立させる必要があるデータタイプを選択します。
5. データが独立したら、**NLA Stride** を使用してオフセットします。  



![alt text](images/img_3001.png)

> データが独立すると、各オブジェクトは独自の「真にユニークな NLA データ」を持つことになります。
> これにより、NLA Stride は **NLA ストリップを正常かつ予測通りにオフセット**できるようになります。
---


#### 2. ⚠️ NLA へ一括プッシュ

本アドオンは、具体的に NLA ストリップに対して機能します。NLA にプッシュされていないアニメーションデータは影響を受けません。

#### ✅ 解決策：一括変換ツール

アドオンには、**リスト内**のすべてのオブジェクトのアニメーションを NLA にプッシュするツールが用意されています（下の緑色の矢印）。注意：これは 3D ビューの選択ではなく、リストを対象としています。

![alt text](images/img_3002.png)

---



## 📖 その他のヒント


#### 1. 整列とオフセットの戦略

- 3D ビューポートで **Alt A** を押してすべて選択解除してから、**リストオブジェクトを選択** 機能を使用して、リストにどのオブジェクトが含まれているかを正確に確認できます。  
<br>

- **順序**は非常に重要であり（オフセットの結果に直接影響します）、名前を使用して順序を決定するようにしてください。オブジェクトが多い場合は、バッチで処理してください。  
<br>

- 混乱した場合は、整列ツールを使用してすべてを統一された開始点にリセットしてください。  
<br>

- オフセットが簡単になるため、まずは 1 つの **完璧なダイナミックな動き** を作ることに集中してください。  
<br>

- アニメーションに**位置 (Location)** が含まれる場合、複製されたものが同じ位置に戻ってしまうことがあります。**Ctrl A** を使用して、変換を **デルタトランスフォーム (Delta Transform)** データに適用してください。  
  <br>![alt text](images/img_4001.png)  

---

#### 2. オフセットの説明
- 線形減衰モード：  
  - 簡易モード：   
  <a href="images/img_4002.png"><img src="images/img_4002.png" width="650"></a>  
  簡易モードは元の状態（左）に基づいて計算します。例：オフセット 100、スケール 1.5。最後のストリップの開始位置と長さは設定と一致しますが、中間のストリップは減衰モードに基づいて変化します。

    ---
  - プロモード：    
  <a href="images/img_4003.png"><img src="images/img_4003.png" width="650"></a>  
  簡易モードとは異なり、プロモードは開始（Head）と終了（Tail）の両方を制御し、それぞれに個別の減衰モードを設定できます。  
  
    ---
  - **注意**：   
  <a href="images/img_4004.png"><img src="images/img_4004.png" width="650"></a>  
  開始と終了の減衰モードが**異なる**場合、ストリップが短くなりすぎたり、消えたりしないように注意してください。
---

#### 3. リストアイコンの凡例

![alt text](images/img_3003.gif)

アイコン A：アニメーションソースモード
アイコン B：アクションは一般的なアニメーションデータを表します（まだ NLA にありません）
アイコン C：利用可能な NLA データ

- B と C の記号は、ソースモード (A) に基づいて変化します：
  - ✔：モード A に一致する**正しい**データが含まれています。
  - ・：データは含まれていますが、モード A に一致**しません**。
  - ✕：データが見つかりません。

例のデータ：
| 項目 | オブジェクトアニメ | マテリアルアニメ | シェイプキーアニメ |
|------|------|------|--------|
| **NLA ストリップ** | cube.049 | cube.050 | cube.051 | 
| **アクティブアクション** | cube.027 | cube.037 | cube.038 | 

- その他：cube.000 (3 つすべてのタイプの NLA を持つ) / cube.039 (アニメーションデータなし)

---




## 🔧 技術リファレンス

  [Blender NLA 公式マニュアル](https://docs.blender.org/manual/en/latest/editors/nla/index.html)

  [Blender API 公式マニュアル](https://docs.blender.org/api/current/bpy.ops.nla.html)

  


## 📘 目次

1. [クイックスタート](#-クイックスタート) 
2. [アップデートのポイント](#-アップデートのポイント) 
3. [機能概要](#-機能概要)      
4. [よくある質問](#-よくある質問) 
5. [その他のヒント](#-その他のヒント) 
6. [技術リファレンス](#-技術リファレンス)
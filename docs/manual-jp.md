<a href="images/NLA-Stride_LOGO2.png"><img src="images/NLA-Stride_LOGO2.png" width="250"></a>

# ユーザーマニュアル (日本語)

> 本マニュアルでは、NLA-Stride Blender アドオンのクイックスタート、操作ガイド、および高度なテクニックについて説明します。

---

## 📘 目次

1. [クイックスタート](#-クイックスタート)  
2. [機能概要](#-機能概要)      
3. [よくある質問](#-よくある質問) 
4. [その他](#-その他) 
5. [技術リファレンス](#-技術リファレンス)

---

## 🚀 クイックスタート

### 1. アドオンのインストール

1. Blender 公式のインストール手順に従ってください ( **[一般的なインストールガイド](https://docs.blender.org/manual/en/latest/editors/preferences/addons.html)** )。

2. インストール後、Blender の 3D ビューポートにある **サイドバー (N) → アニメーション** タブに **NLA Stride Tool** が表示されます。


![alt text](images/img_1001.png)



---

### 2. アニメーションを持つオブジェクトの選択

<a href="images/img_1002.png">
  <img src="images/img_1002.png" width="650">
</a>

アニメーションデータを含む 1 つまたは複数のオブジェクトを選択します。 NLA ストリップではなく標準のアクションである場合は、「NLA へ一括プッシュ」セクションを参照してください。

---

### 3. リストに追加

![alt text](images/img_1003.png)

⚠️ 注意：このアドオンはリストに基づいて動作します。現在のビューポートでの選択状態とは関係ありません。

---

### 4. NLA の整列 / オフセット操作


<a href="images/img_1004.png"><img src="images/img_1004.png" width="650"></a>

<a href="images/img_1005.png"><img src="images/img_1005.png" width="650"></a>

<a href="images/img_1006.png"><img src="images/img_1006.png" width="650"></a>


上記は NLA の整列およびオフセット機能のデモンストレーションです。

---

### 5. アニメーションの魔法を楽しむ

<a href="images/DEMO_01.mp4">
  <img src="images/DEMO_01.gif" width="720">
</a>

<a href="images/DEMO_02.mp4">
  <img src="images/DEMO_02.gif" width="720">
</a>

<a href="images/DEM3_03.mp4">
  <img src="images/DEMO_03.gif" width="720">
</a>

<a href="images/DEM3_04.mp4">
  <img src="images/DEMO_04.gif" width="720">
</a>

このサンプルモデルは、台湾のブランド [SANSUI / 山水](https://www.sansuitw.com/?gad_source=1&gad_campaignid=23085773952&gbraid=0AAAAAoXC59ENhboAZDO-y0zK4yQpidtXM&gclid=CjwKCAiAybfLBhAjEiwAI0mBBscjnZOEYBBY127EypNMfnL1h_Vqm_HACczeJBOqMK-euDJFPb1iAxoC7rkQAvD_BwE) より提供いただきました。

---

## 🧰 機能概要

#### 1. データソース 

![alt text](images/img_2001.png)

- A : 初期化して選択項目を追加
  
  リストを一度クリアしてから、シーン内で現在選択されているオブジェクトを追加します。
<br>

- B : リストをクリア
  
  リスト内のすべてのデータを消去します。
  <br>

- C : アニメーションソース
  
  現在、以下の 3 つのタイプをサポートしています：
    -  オブジェクトアニメーション 
    -  シェイプキーアニメーション
    -  マテリアルアニメーション
<br>

- D : リスト項目の 追加 / 削除
  
  追加しても既存の項目は **クリアされません**。オブジェクトは **選択した順序** で末尾に追加されます。 すでにリストにあるオブジェクトを選択した場合、それらはリストの最後に移動します。 この追加ロジックは「A」とは異なります。 削除機能も「1-J」とは異なります。
<br>

- E : リスト操作 (ドロップダウンメニュー)
  
  詳細は [1-1 リスト操作](#1-1-リスト操作) を参照してください。
<br>

- F : リスト項目の 上へ / 下へ 移動
  
  順序を手動で調整します。 手動で調整された結果は、**「元の順序」** として定義されます。
<br>

- G : アニメーションを NLA へプッシュ (ドロップダウンメニュー)
  
  リスト内のオブジェクトのみを対象に変換を行います。
<br>
  
  
-  PS. [3. リスト内のアイコンの意味](#3-リスト内のアイコンの意味)

#### 1-1. リスト操作

![alt text](images/img_2002.png)

- H : 初期化して選択項目を追加
 
  リストを一度クリアしてから、シーン内で現在選択されているオブジェクトを追加します。
<br>

- I : 4 つのソートオプション
  
  最も重要なのは **元の順序に戻す** です。 このアドオンはその順序を記録しています。 他の 3 つは自動ソートです。
<br>

- J : シーン内の選択項目を削除
 
  3D ビューポートでの現在の選択に基づいて、リストからオブジェクトを削除します。 これは「1-D」の削除ツールとは異なります。

#### 2. データポジショニング

![alt text](images/img_2003.png)

- K : 3 つのストリップモード
  - 単一ストリップ : 特定の 1 つのストリップのみを対象にします。
  - 単一トラック : 1 つのトラック上のすべてのストリップを 1 つのグループとして扱います (相対位置は変わりません)。
  - 全トラック : オブジェクトのすべてのトラックを同時に変更するのと同等です (相対位置は変わりません)。
<br>

- L : 3 つの参照点
  - どのスロット : (マテリアルモードのみ) UI 上で **上から下** へ計算されます。
  - どのトラック : NLA エディターで **下から上** へ計算されます。
  - どのストリップ : NLA エディターで **左から右** へ計算されます。
<br>

  **!! 注意 : ターゲットが正しく配置されていない場合、NLA Stride はオフセットを実行できません。**

#### 3. NLA 整列ツール (初期化値)
![alt text](images/img_2004.png)

- M : 5 つの整列ターゲット
  - 最大開始フレーム基準 : リスト内で最も **遅く** 開始するストリップの **開始点** に合わせます。
  - 最小開始フレーム基準 : リスト内で最も **早く** 開始するストリップの **開始点** に合わせます (常用)。
  - 最大終了フレーム基準 : リスト内で最も **遅く** 終了するストリップの **終了点** に合わせます (常用)。
  - 最小終了フレーム基準 : リスト内で最も **早く** 終了するストリップの **終了点** に合わせます。
  - 現在の再生フレーム基準 : 現在のプレイヘッドの位置に合わせます (最も一般的)。
<br>

- N : 3 つの整列モード
  - 開始で整列 : ストリップの左側をターゲットに合わせます。 通常、**開始点** の整列に使用されます。
  - 中央で整列 : ストリップの中心をターゲットに合わせます。
  - 終了で整列 : ストリップの右側をターゲットに合わせます。 通常、**終了点** の整列に使用されます。
<br>

- O : スケールをリセット
  
  リスト内のすべての NLA ストリップのスケール値を 1.0 にリセットします。


#### 4. 簡易モード

![alt text](images/img_2005.png)

- P : 減衰モード [( 詳細説明 )](#2-オフセットの説明)
  
  - 4 つの計算式：1. リニア / 2. イーズイン / 3. イーズアウト / 4. イーズインアウト。
<br>

- Q : オフセット量 ( 単位：**フレーム** )
  
  - 個々のストリップ間の間隔ではなく、リストの最初と最後のオブジェクト間の合計差です (負の値も可能です)。
<br>

- R : スケール
  
  - 増分スケールではなく、リストの最初と最後のオブジェクト間のスケール差 (0 ～ 1) です。
<br>

- S : 簡易 NLA ストライドを実行 (繰り返しクリックすると計算が累積されます)。
<br>

#### 5. プロモード
![alt text](images/img_2006.png)
  **>> 本アドオンの核心です。簡単な設定で、ストリップのオフセットとスケールが自動的に調整されます <<**

- T : 減衰モード [( 詳細説明 )](#2-オフセットの説明)
  
  - 4 つの計算式：1. リニア / 2. イーズイン / 3. イーズアウト / 4. イーズインアウト。
<br>

- U : 開始フレームを設定
  
  - リスト内のすべてのオブジェクトのアニメーションシーケンス全体の **開始** 時間を設定します。
<br>

- V : オフセット比率 (開始)
  
  - 減衰モード (T) を乗算してオフセットを計算し、すべてのストリップの開始点を自動配置するために使用されます。
<br>

- W : 減衰モード [( 詳細説明 )](#2-オフセットの説明)
  
  - 4 つの計算式：1. リニア / 2. イーズイン / 3. イーズアウト / 4. イーズインアウト。
<br>

- X : 終了フレームを設定
  
  - リスト内のすべてのオブジェクトのアニメーションシーケンス全体の **終了** 時間を設定します。
<br>

- Y : オフセット比率 (終了)
  
  - ストリップの終了点のオフセット比率です。
<br>

- Z : プロ NLA ストライドを実行 (繰り返しクリックしても計算は累積 **されません**)。
<br>


---

## ❓ よくある質問


#### 1. ⚠️ 「インスタンス化されたデータ (Instanced Data)」への注意

本アドオンは主に NLA ストリップ自体のオフセットと整列を処理します。 Blender の「インスタンス化されたデータ」の関係は自動的には処理 **されません**。

#### インスタンス化されたデータとは？

**複数のオブジェクトが同じデータを共有** している場合、そのデータブロックは「インスタンス化 (Instanced)」されています。

- 例：  
  - 2 つのオブジェクトが同じマテリアルを共有している。
  - 同じアクション、メッシュ、またはその他のデータブロックを共有している。

NLA エディターでは 2 つの独立したストリップに見えるかもしれませんが、実際には **背後で同じデータブロックを指しています**。
その結果、**NLA Stride を使用してオフセット** を行う際、アドオンは異なるストリップを移動させているように見えても、実際には同じデータブロックを修正しているため、**期待したオフセット効果が得られません**。


#### ✅ 解決策 (以下のスクリーンショットに従ってください)

> 💡 **重要なアプローチ：オフセットを行う前にデータを独立させる。**

手順 (図に示す通り)：

1. 3D ビューポートで処理対象のオブジェクトを選択します。
2. **オブジェクト → 関連 (Relations)** を開きます。
3. **シングルユーザー化 (Make Single User)** をクリックします。
4. 独立させる必要があるデータタイプ (例：オブジェクトアニメーション) を選択します。
5. データが独立したことを確認してから、**NLA Stride** でオフセットを実行します。



![alt text](images/img_3001.png)

> データが独立すると、各オブジェクトは独自の NLA データを持つようになります。
> これにより、NLA Stride は **NLA ストリップを正常かつ予測どおりにオフセット** できるようになります。
---


#### 2. ⚠️ NLA の一括作成

本アドオンは NLA ストリップを対象としています。NLA ストリップに「プッシュダウン」されていないアニメーションデータは影響を受けません。

#### ✅ 解決策：NLA プッシュツール

アドオンには一括変換ツールが用意されています (下図の緑色の矢印)。これは 3D ビューポートの選択ではなく、**リスト内の** オブジェクトに適用されることに注意してください。

![alt text](images/img_3002.png)

---



## 📖 その他説明


#### 1. 整列とオフセット戦略のヒント

- 3D ビューポートで **Alt + A** を押してすべての選択を解除してから、**リスト内のオブジェクトを選択** 機能を使用して、リストにどのオブジェクトが含まれているかを確認できます。
<br>
- **順序** は非常に重要であり、オフセット後のアニメーション状態に直接影響します。 可能であれば、名前の命名規則を使用して順序を決定してください。 オブジェクトが非常に多い場合は、バッチで処理してください。
<br>
- 状況が混乱した場合は、整列ツールを使用して一度統一してください。
<br>
- アニメーションのオフセットが非常に簡単になるため、**完璧な動き** を 1 つ作ることに集中してください。
<br>
- 動きのデザインに **位置 (Location)** のキーが含まれている場合、複製時にアニメーションが元の座標にジャンプして戻る可能性があることに注意してください。 **Ctrl + A** を使用してトランスフォームを適用し、新しい座標をデルタトランスフォームに書き込むことができます。
![alt text](images/img_4001.png)
---

#### 2. オフセットの説明
- 線形スタッキングモード：
  - 簡易モード：
  <a href="images/img_4002.png"><img src="images/img_4002.png" width="650"></a>
  簡易モードは元の状態 (図の左端) に基づいて計算されます。 オフセットを 100、スケールを 1.5 に設定すると、最後のストリップの開始点と終了点はターゲットと正確に一致します。 ただし、減衰モードが異なると、中間ストリップの分布が変わります。

    ---

  - プロモード：
  違いは、プロモードでは開始と終了の両方を制御できる点です。 2 つの減衰設定があります。
  <a href="images/img_4003.png"><img src="images/img_4003.png" width="650"></a>
  注意：開始と終了の減衰モードが **異なる** 場合、アニメーションストリップが短くなりすぎたり、消失したりする可能性があるため注意してください。
  <a href="images/img_4004.png"><img src="images/img_4004.png" width="650"></a>

---

#### 3. リスト内のアイコンの意味

![alt text](images/img_3003.gif)

アイコン A：データモード
アイコン B：Action は標準的なアニメーションデータ (非 NLA) を表します。
アイコン C：利用可能な NLA データ。

- B と C のアイコンの意味は、列 A のデータモードによって変わります：
  - ✔：列 A のモードに一致する **正しい** データが含まれています。
  - ・：データが含まれていますが、列 A で設定されたタイプでは **ありません**。
  - ✕：データが見つかりません。

ビューポート内のデータ：
| 項目 | オブジェクトアニメーション | マテリアルアニメーション | シェイプキーアニメーション |
|------|------|------|--------|
| **NLA ストリップ** | cube.049 | cube.050 | cube.051 | 
| **アクティブなアクション** | cube.027 | cube.037 | cube.038 |

- その他：cube.000 (3 つのタイプすべての NLA を保持) / cube.039 (アニメーションデータなし)。

---

## 🔧 技術リファレンス

  [Blender NLA 公式マニュアル](https://docs.blender.org/manual/en/latest/editors/nla/index.html)

  [Blender API 公式マニュアル](https://docs.blender.org/api/current/bpy.ops.nla.html)

  


## 📘 目次

1. [クイックスタート](#-クイックスタート)  
2. [機能概要](#-機能概要)      
3. [よくある質問](#-よくある質問) 
4. [その他](#-その他) 
5. [技術リファレンス](#-技術リファレンス)

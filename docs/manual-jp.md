<a href="images/NLA-Stride_LOGO2.png"><img src="images/NLA-Stride_LOGO2.png" width="250"></a>  

# ユーザーマニュアル

> このマニュアルでは、NLA-Stride Blender アドオンの機能、テクニック、およびよくある既知の問題への回答を紹介します。

---

## 📘 目次

1. [クイックスタート](#Quick_Start)  
2. [アップデートのポイント](#Version_Updates)
3. [機能概要](#Feature_Overview)      
4. [よくある質問](#FAQ) 
5. [その他](#Others) 
6. [技術リファレンス](#Technical_Reference)

---

## 🚀 クイックスタート
<a id="Quick_Start"></a>

### 1. アドオンのインストール

1. Blender 公式のインストール手順に従ってください ( **[一般的なインストールガイド](https://docs.blender.org/manual/en/latest/editors/preferences/addons.html)** )

2. インストール後、Blender 3D ビューポートの **サイドバー → アニメーション** タブに **NLA Stride Tool** が表示されます。 
<br>![alt text](images/img_1001.png)



---

### 2. アニメーションを持つオブジェクトを選択  
<a href="images/img_1002.png">
  <img src="images/img_1002.png" width="650">
</a>  

アニメーションデータを含む 1 つまたは複数のオブジェクトを選択します。NLA アニメーションではなく標準のアニメーションを使用している場合は、「NLA 一括作成」の説明を参照してください。

---

### 3. リストに追加

![alt text](images/img_1003.png)

⚠️ 注意：アドオンはリストに基づいて動作するため、ビューポートでのリアルタイムなオブジェクト選択とは独立しています。

---

### 4. NLA 整列 / オフセット操作


<a href="images/img_1004.png"><img src="images/img_1004.png" width="650"></a>  

<a href="images/img_1005.png"><img src="images/img_1005.png" width="650"></a>  

<a href="images/img_1006.png"><img src="images/img_1006.png" width="650"></a>  


上記は NLA の整列およびオフセット機能のデモンストレーションです。

---

### 5. アニメーションの魅力を楽しむ

<a href="images/DEMO_01.mp4">
  <img src="images/DEMO_01.gif" width="720">
</a>  

<a href="images/DEMO_02.mp4">
  <img src="images/DEMO_02.gif" width="720">
</a>  

<a href="images/DEM3_03.mp4">
  <img src="images/DEMO_03.gif" width="720">
</a>  

<a href="images/DEM3_04.mp4">
  <img src="images/DEMO_04.gif" width="720">
</a>  

サンプルモデルを提供してくださった台湾のブランド [SANSUI / 山水](https://www.sansuitw.com/?gad_source=1&gad_campaignid=23085773952&gbraid=0AAAAAoXC59ENhboAZDO-y0zK4yQpidtXM&gclid=CjwKCAiAybfLBhAjEiwAI0mBBscjnZOEYBBY127EypNMfnL1h_Vqm_HACczeJBOqMK-euDJFPb1iAxoC7rkQAvD_BwE) に感謝いたします。

---
## 🌟 アップデートのポイント
<a id="Version_Updates"></a>
  
#### v1.0.0 の主なアップデート
- リストのエクスポート / インポート / 追記 
  ![alt text](images/v100_001.png)  
  1. リスト操作に 3 つの新しい機能が追加されました。
  2. エクスポートとインポートは *.json ファイルを使用します。
  3. 「追記」はリストの最後尾に項目を追加します。
  4. 名前が重複している場合は、既存の項目が優先されます。
#### v0.9.8 の主なアップデート  
- 初回公開版  
---
## 🧰 機能概要
<a id="Feature_Overview"></a>
 

#### 1. アニメーションソース 

![alt text](images/img_2001.png)

- A : 初期化して選択を追加    
  現在のリストをクリアし、シーンで現在選択されているオブジェクトを追加します。  
  <br>
- B : リストをクリア  
  リスト内のすべてのデータを消去します。  
  <br>
- C : アニメーションソース  
    現在、3 つのタイプをサポートしています：  
    -  オブジェクトアニメーション  
    -  シェイプキーアニメーション  
    -  マテリアルアニメーション
  <br>
- D : リストのオブジェクトを 追加 / 削除  
  追加してもリストは **クリアされません**。オブジェクトは **選択順に基づき** 最後尾に追加されます。既にリストにあるオブジェクトを選択した場合、それらは最後尾に移動します。これは方法 A とは異なります。削除も 1-J とは異なります。  
  <br>

- E : リスト操作 (ドロップダウンメニュー)  
  詳細は [1-1 リスト操作](#List_Functions) を参照してください。
  <br>

- F : 選択項目を上へ / 下へ移動  
  手動で順序を調整します。順序が手動で変更されると、それが **「キャッシュされた元の順序」** として定義されます。
  <br>

- G : NLA にプッシュ (ドロップダウンメニュー)  
  リスト内のオブジェクトのみを NLA ストリップに変換します。
  <br>  
  
-  PS. [3. リスト内のアイコンの意味](#List_Icon_Meanings)

#### 1-1. リスト操作
<a id="List_Functions"></a>

![alt text](images/img_2002.png)

- H : 初期化して選択を追加   
  リストデータをクリアし、シーンで選択されているオブジェクトを追加します。
  <br>

- I : 4 つのソート状態    
  最も重要なのはアドオンが記録する **元の順序** です。他の 3 つは一時的なソート状態です。
  <br>

- J : シーンの選択を削除   
  3D シーンで現在選択されているオブジェクトをリストから削除します (1-D とは異なります)。
  <br>

#### 2. オフセットストリップを指定

![alt text](images/img_2003.png)

- K : 3 つのストリップモード  
  - 単一ストリップ : 特定の 1 つのストリップのみを対象にします。
  - 単一トラック : 1 つのトラック上のすべてのストリップを 1 つのユニットとして扱います (相対位置は維持されます)。
  - 全トラック : オブジェクトのすべてのトラックが一緒に変更されます (相対位置は維持されます)。
  <br>

- L : 3 つのロケーター  
  - どのスロット : マテリアルモードのみ。NLA UI で **上から下** に計算されます。
  - 第何トラック : NLA UI で **下から上** に計算されます。
  - 第何ストリップ : NLA UI で **左から右** に計算されます。
  <br>

  **!! 注意：ターゲットが正しく指定されていない場合、NLA オフセットは実行できません。**

#### 3. NLA 整列ツール (初期値)
![alt text](images/img_2004.png)

- M : 5 つの整列モード  
  - 最大開始フレームに合わせる : リスト内のストリップの **最も遅い** 開始点に基づきます。
  - 最小開始フレームに合わせる : リスト内のストリップの **最も早い** 開始点に基づきます (常用)。
  - 最大終了フレームに合わせる : リスト内のストリップの **最も遅い** 終了点に基づきます (常用)。
  - 最小終了フレームに合わせる : リスト内のストリップの **最も早い** 終了点に基づきます。
  - 現在の時間に合わせる : 現在の再生ヘッドの位置に基づきます (最も多用)。
  <br>

- N : 3 つの整列方法  
  - 開始を揃える : 左側をターゲットに揃えます。
  - 中央を揃える : 中央をターゲットに揃えます。
  - 終了を揃える : 右側をターゲットに揃えます。
  <br>

- O : スケールをリセット  
  リスト内のすべての NLA ストリップのスケール値を 1 に戻します。
  <br>


#### 4. 簡易モード

![alt text](images/img_2005.png)  
- P : 簡易モード減衰 [(詳細説明)](#Stride_Description)  
  オフセット計算式は 4 つあります：1. 線形 / 2. イーズイン / 3. イーズアウト / 4. イーズインアウト。
  <br>

- Q : オフセット量 (単位：**フレーム**)  
  リストの最初と最後のオブジェクトの合計差です (負の値も入力可能です)。
  <br>

- R : スケール  
  リストの最初と最後のオブジェクトのスケール差です (0 ～ 1)。
  <br>

- S : 簡易 NLA ストライドを実行 (クリックを繰り返すと計算が累積されます)。
  <br>

#### 5. プロフェッショナルモード
![alt text](images/img_2006.png)  
  **>> 本アドオンの核心：簡単な設定でストリップのオフセットとスケールが自動調整されます <<**

- T : プロ開始減衰 [(詳細説明)](#Stride_Description)  
  計算式は 4 つ：1. 線形 / 2. イーズイン / 3. イーズアウト / 4. イーズインアウト。
  <br>

- U : 開始フレームを設定  
  リスト内のすべてのオブジェクトのアニメーションの全体的な **開始** 時間を設定します。
  <br>

- V : オフセット比率 (開始)    
  開始減衰 (T) を掛け合わせたオフセット量で、すべてのストリップの開始点を自動設定します。
  <br>

- W : プロ終了減衰 [(詳細説明)](#Stride_Description)    
  計算式は 4 つ：1. 線形 / 2. イーズイン / 3. イーズアウト / 4. イーズインアウト。
  <br>

- X : 終了フレームを設定    
  リスト内のすべてのオブジェクトのアニメーションの全体的な **終了** 時間を設定します。
  <br>

- Y : オフセット比率 (終了)    
  最初と最後のオブジェクトの差です (負の値も入力可能です)。
  <br>

- Z : プロフェッショナル NLA ストライドを実行 (クリックを繰り返しても計算は **累積されません**)。
  <br>


---

## ❓ よくある質問
<a id="FAQ"></a>


#### 1. ⚠️ 「インスタンス化されたデータ (Instanced Data)」の詳細に注意

本アドオンは、NLA ストリップ（Strips）自体のオフセットと整列を主に対象としており、  
Blender の「インスタンス化されたデータ」の関係を **自動的には処理しません**。

#### インスタンス化されたデータとは？

**複数のオブジェクトが同じデータブロックを共有している**場合、そのデータは「インスタンス化」されています。

- 例：  
  - 2 つのオブジェクトが同じマテリアルを共有している。  
  - 同じアクション (アニメーション)、メッシュ、またはその他のデータブロックを共有している。  

NLA エディターではこれらは独立したストリップに見えますが、実際には **同じ基盤データセットを指しています**。
結果として、**NLA Stride でオフセット**を行っても、ストリップは移動しているように見えますが、同じデータに影響を与え続けているため、**意図したオフセット効果が得られません**。


#### ✅ 解決方法 (以下の手順に従ってください)

> 💡 **ポイント：オフセットを適用する前に、データを「シングルユーザー (Single User)」にします。**

手順 (画像参照)：

1. 3D ビューポートでオブジェクトを選択します。  
2. **オブジェクト → 関係 (Relations)** に移動します。  
3. **シングルユーザー化 (Make Single User)** をクリックします。  
4. 必要に応じてデータタイプ (例：オブジェクトアニメーション) を選択します。
5. データが独立した後、**NLA Stride** を使用してオフセットを行います。  



![alt text](images/img_3001.png)

> データが独立すると、各オブジェクトは「真に独立した NLA データ」を持つようになります。
> これにより、NLA Stride は **通常通り予測可能な方法でストリップをシフト** できます。
---


#### 2. ⚠️ NLA 一括作成

本アドオンは NLA ストリップに対して動作します。NLA にプッシュされていない標準のアニメーション (アクティブなアクション) は変更されません。

#### ✅ 解決方法：一括変換ツール

アドオンには、リスト内のオブジェクトを一度に NLA に変換するツールが用意されています (下図の緑色の矢印)。注意：これは 3D ビューポートの選択ではなく、**リスト内** のオブジェクトに適用されます。

![alt text](images/img_3002.png)

---



## 📖 その他
<a id="Others"></a>


#### 1. 整列およびオフセット戦略のヒント

- 3D ビューポートで **Alt A** を押してすべての選択を解除してから、**「リストオブジェクトを選択」** 機能を使用して、リストに何が含まれているかを確認します。  
<br>

- **順序** はオフセット後のアニメーション状態に直接影響するため非常に重要です。可能な場合は名前を使用して順序を決定してください。オブジェクトが非常に多い場合は、分担して処理することを検討してください。  
<br>

- 状況が混乱した場合は、整列ツールを使用してすべてを同期させて戻します。  
<br>

- アニメーションのオフセットが非常に簡単になったため、1 つの **完璧な動き** を作ることに集中してください。  
<br>

- モーションデザインについて：**位置** がキーフレーム設定されている場合、コピーして再生するとオブジェクトが記録された座標に戻ってしまうことがあります。その場合は、**Ctrl A** (トランスフォームの適用) を使用して、新しい位置を **デルタトランスフォーム** データに書き込んでください。  
  <br>![alt text](images/img_4001.png)  

---

#### 2. ストライドの説明
<a id="Stride_Description"></a>

- 線形スタックモード：  
  - 簡易モード：   
  <a href="images/img_4002.png"><img src="images/img_4002.png" width="650"></a>  
  簡易モードは元の状態 (画像の一番左) に基づいて計算されます。例えば、オフセット 100、スケール 1.5 に設定した場合、最後のストリップの開始点と長さは常に同じになりますが、異なる減衰モードによって中間ストリップの開始点が異なり、オフセットの「感覚」が変わります。

    ---
  - プロフェッショナルモード：    
  <a href="images/img_4003.png"><img src="images/img_4003.png" width="650"></a>  
  簡易モードとは異なり、プロフェッショナルモードでは「開始」と「終了」を個別に制御でき、それぞれに異なる減衰モードを設定できます。  
  
    ---
  - **注意**：   
  <a href="images/img_4004.png"><img src="images/img_4004.png" width="650"></a>  
  開始と終了の減衰モードが **異なる** 場合、アニメーションストリップが短くなりすぎたり消えたりしないか注意してください。
---

#### 3. リスト内のアイコンの意味
<a id="List_Icon_Meanings"></a>

![alt text](images/img_3003.gif)

図 A : データモード
図 B : Action は標準のアニメーションデータ (非 NLA) を表します
図 C : 利用可能な NLA データ

- B 欄と C 欄の記号の意味は、A 欄で選択されたデータモードによって変わります：
  - ✔ : A 欄の設定に一致する **正しい** データが含まれています。
  - ・ : データはありますが、A 欄で設定されたタイプでは **ありません**。
  - ✕ : データがありません。

例のデータ：
| 項目 | オブジェクトアニメーション | マテリアルアニメーション | シェイプキーアニメーション |
|------|------|------|--------|
| **NLA ストリップ** | cube.049 | cube.050 | cube.051 | 
| **アクティブアクション** | cube.027 | cube.037 | cube.038 | 

- その他：cube.000 (3 種類すべての NLA を保持) / cube.039 (アニメーションデータなし)

---




## 🔧 技術リファレンス
<a id="Technical_Reference"></a>

  [Blender NLA 公式マニュアル](https://docs.blender.org/manual/en/latest/editors/nla/index.html)

  [Blender API 公式マニュアル](https://docs.blender.org/api/current/bpy.ops.nla.html)

  


## 📘 目次

1. [クイックスタート](#Quick_Start) 
2. [アップデートのポイント](#Version_Updates) 
3. [機能概要](#Feature_Overview)      
4. [よくある質問](#FAQ) 
5. [その他](#Others) 
6. [技術リファレンス](#Technical_Reference)